{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" -}}
{{- $caption := .Get "caption" -}}
{{- $link := .Get "link" | default $src -}}

{{- $base := replaceRE "\\.(jpg|jpeg|png|gif)$" "" $src -}}
{{- $webp := printf "%s.webp" $base -}}

<figure>
  <a href="{{ $link }}">
    <picture>
      <source srcset="{{ $webp }}" type="image/webp">
      <img src="{{ $src }}" alt="{{ $alt }}">
    </picture>
  </a>
  {{- if $caption -}}
  <figcaption>{{ $caption | markdownify }}</figcaption>
  {{- end -}}
</figure>
